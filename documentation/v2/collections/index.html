<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Collection Class - Cora Framework Documentation</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/base.css" rel="stylesheet">
        <link href="../../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">Cora Framework Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../../..">About</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Setup <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../../setup/install/">Installation</a>
</li>

                    
                        
<li >
    <a href="../../../setup/configuration/">Configuration</a>
</li>

                    
                        
<li >
    <a href="../../../setup/advanced/">Advanced Configuration</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorals <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../../tutorials/intro/">Intro to Cora</a>
</li>

                    
                        
<li >
    <a href="../../../tutorials/composer/">Using Composer</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Docs <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../release_notes/">Release Notes</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">ADM ORM</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../ADM/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../ADM/implementation/">Implementation</a>
</li>

        
            
<li >
    <a href="../ADM/model/">Model</a>
</li>

        
            
<li >
    <a href="../ADM/relationships/">Model Relationships</a>
</li>

        
            
<li >
    <a href="../ADM/subsets_loadmapping/">Subsets and LoadMapping</a>
</li>

        
            
<li >
    <a href="../ADM/repository/">Repository</a>
</li>

        
            
<li >
    <a href="../ADM/gateway/">Gateway</a>
</li>

        
            
<li >
    <a href="../ADM/factory/">Factory</a>
</li>

        
            
<li >
    <a href="../ADM/lifecycle/">Lifecycle Callbacks</a>
</li>

        
            
<li >
    <a href="../ADM/database_gen/">Automated DB Creation</a>
</li>

        
            
<li >
    <a href="../ADM/opt_locking/">Optimistic Locking</a>
</li>

        
    </ul>
  </li>

                    
                        
<li class="active">
    <a href="./">Collection Class</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Database Class</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../databaseclass/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../databaseclass/custom_query/">Custom Queries</a>
</li>

        
            
<li >
    <a href="../databaseclass/methods_utility/">Utility Methods</a>
</li>

        
            
<li >
    <a href="../databaseclass/methods_select/">SELECT Methods</a>
</li>

        
            
<li >
    <a href="../databaseclass/methods_update/">UPDATE Methods</a>
</li>

        
            
<li >
    <a href="../databaseclass/methods_insert/">INSERT Methods</a>
</li>

        
            
<li >
    <a href="../databaseclass/methods_delete/">DELETE Methods</a>
</li>

        
            
<li >
    <a href="../databaseclass/methods_create/">CREATE Methods</a>
</li>

        
            
<li >
    <a href="../databaseclass/databaseresult/">DatabaseResult Class</a>
</li>

        
    </ul>
  </li>

                    
                        
<li >
    <a href="../dependency-injection/overview/">Dependency Injection</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Events</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../events/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../events/eventmanager/">Event Manager</a>
</li>

        
            
<li >
    <a href="../events/eventmapping/">Event Mapping</a>
</li>

        
            
<li >
    <a href="../events/event/">Event</a>
</li>

        
            
<li >
    <a href="../events/listener/">Listener</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">MVC Pattern</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../mvc/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../mvc/models/">Models</a>
</li>

        
            
<li >
    <a href="../mvc/views/">Views</a>
</li>

        
            
<li >
    <a href="../mvc/controllers/">Controllers</a>
</li>

        
            
<li >
    <a href="../mvc/libraries/">Libraries</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Routing</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../routing/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../routing/custom_routes/">Custom Routes</a>
</li>

        
    </ul>
  </li>

                    
                        
<li >
    <a href="../validationclass/overview/">Validate Class</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">CS Topics <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../../computerscience/computability/">Computability</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../ADM/opt_locking/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../databaseclass/overview/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#collections">Collections</a></li>
        
            <li><a href="#introduction">Introduction</a></li>
        
            <li><a href="#create-from-simple-array">Create From Simple Array</a></li>
        
            <li><a href="#create-from-associative-array">Create From Associative Array</a></li>
        
            <li><a href="#create-from-object-array">Create From Object Array</a></li>
        
            <li><a href="#using-data-keys">Using Data Keys</a></li>
        
            <li><a href="#utility-methods">Utility Methods</a></li>
        
            <li><a href="#performance-optimizations">Performance Optimizations</a></li>
        
            <li><a href="#warning-about-mixing-closures-with-other-types">Warning About Mixing Closures With Other Types</a></li>
        
            <li><a href="#non-existent-resources">Non-Existent Resources</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="collections">Collections</h1>
<p><span class="text-green">
Cora's Collection class is meant to be a substitute for arrays and gives you much more control over 
your data. You can either store items of the same type (recommended) or items of mixed type (have to 
be careful). Under the hood it makes efforts to optimize the fetching and counting of data.
</span></p>
<h2 id="introduction">Introduction</h2>
<p><span class="subTitle-h2">A few quick examples to spark interest</span></p>
<p>Cora Collections are:</p>
<ul>
<li><span class="text-green">Fast</span> (speed comparable to standard arrays)</li>
<li><span class="text-green">Flexible</span> (many different types of syntax you can use)</li>
<li><span class="text-green">Easy</span> (things just work the way you'd expect)</li>
</ul>
<h3 id="example-1-smooth-object-to-collection-transitions">Example #1 - Smooth Object to Collection Transitions</h3>
<p>Rather than force developers to use a PSR-11 style get() method to access items, I wanted to do something that would flow better when working with data (although you can still use get() if you want).</p>
<p>Role in this example is a simple object with a name property and an associated access level you can set through the constructor. The second argument passed to our Collection tells it to index the items using each Role's name. This allows us to easily access the data in a symantically friendly way:</p>
<pre><code class="php">$roles = new \Cora\Collection([
    new Role('user', 1),
    new Role('admin', 2),
    new Role('developer', 3)
], 'name');

echo $roles-&gt;admin-&gt;accessLevel;        // Returns 2 - Using Object syntax
echo $roles-&gt;get('admin')-&gt;accessLevel; // Returns 2 - Using PSR11 standard syntax
</code></pre>

<p>Under the hood, both the approaches above do the same thing, but the first hides the fact a function call is happening in order to provide a more seemless experience. To really see the power of this approach it's necessary to wire up multiple pieces of data together which we'll do next. This starts to get at the heart of why this Collection class was designed, which was to provide an innovative approach to manipulating highly interconnected data using Cora's ORM.</p>
<pre><code class="php">// Setup some data we can play with
$users = new \Cora\Collection([
    (object) ['name'=&gt;'bob', 'age'=&gt;32],
    (object) ['name'=&gt;'jim', 'age'=&gt;62],
    (object) ['name'=&gt;'luann', 'age'=&gt;58]
], 'name');

$roles = new \Cora\Collection([
    (object) ['name'=&gt;'user', 'accessLevel'=&gt;1],
    (object) ['name'=&gt;'admin', 'accessLevel'=&gt;2],
    (object) ['name'=&gt;'developer', 'accessLevel'=&gt;3]
], 'name');

// Setup relationship between one user and another
$users-&gt;bob-&gt;father = $users-&gt;jim;

// Setup relationship between roles and users
$roles-&gt;admin-&gt;peopleWithThisPermission = new \Cora\Collection([$users-&gt;bob, $users-&gt;luann], 'name');

// Show how we can chain stuff together (exaggerated example)
echo $roles-&gt;admin-&gt;peopleWithThisPermission-&gt;bob-&gt;father-&gt;name;                // Returns &quot;jim&quot;
echo $roles-&gt;get('admin')-&gt;peopleWithThisPermission-&gt;get('bob')-&gt;father-&gt;name;  // Returns &quot;jim&quot;

// loop (more typical usage example)
foreach ($roles-&gt;admin-&gt;peopleWithThisPermission as $user) {
  echo $user-&gt;name; // Returns &quot;bob&quot; and &quot;luann&quot;
}
</code></pre>

<p>The object syntax provided by the Cora Collection class allows you to write code that feels cohesive when interweaving calls to collections of objects and individual objects together.</p>
<h3 id="example-2-direct-offset-assignment">Example #2 - Direct Offset Assignment</h3>
<p>Another thing you may find refreshing about the Cora collection class is the way in which you can add things to the collection. While other collection classes may require you call "push()" or "add()" to add additional things to the collection, Cora Collections give you the option to do direct assignment when it makes sense.</p>
<pre><code class="php">$items = new \Cora\Collection();
$items-&gt;thing1 = 'A Hat';
$items-&gt;thing2 = 'Subglasses';

echo $items-&gt;thing1; // Returns &quot;A Hat&quot;;
foreach ($items as $item) {
  echo $item; // Returns both items
}
</code></pre>

<p>If you read up on our Dependency Injection documentation, it's actually a derivative of this Collection class that provides the underlying container for it.</p>
<pre><code class="php">$app = new \Cora\Collection();

$app-&gt;resource1 = function($app) {
  $user = new \stdClass();
  $user-&gt;name = 'Bob';
  return $user;
};

$app-&gt;resource2 = function($app) {
  return ['item1', 'item2'];
};

// Simulating a 3rd resource that has a dependency on Resource #2
$app-&gt;resource3 = function($app) {
  return new \Cora\Collection($app-&gt;resource2);
};

echo $app-&gt;resource1-&gt;name; // Returns &quot;Bob&quot;;
echo $app-&gt;resource1()-&gt;name; // Returns &quot;Bob&quot;;

foreach ($app-&gt;resource3 as $item) {
  echo $item; // Returns &quot;item1&quot; and &quot;item2&quot;
}
</code></pre>

<p>Note that by default the Collection will attempt to execute Closures when they are the resource fetched unless you tell it not to. That's why the example above has the same result with and without the parenthesis. That might seem a little strange at first thought, but the reason is to yet again facilitate a smooth object syntax:</p>
<pre><code class="php">// Friendly syntax. Returns 'item1'
echo $app-&gt;resource3[0];
echo $app-&gt;resource3-&gt;off0;

// Less friendly
echo $app-&gt;resource3()[0]; 
echo $app-&gt;resource3()-&gt;off0;
</code></pre>

<p>When a Closure is executed by the collection, an instance of the collection is passed in as the first argument. That's how resource 3 was able to have a dependency on another Collection item. If you don't want this behavior (the auto-execution of Closures and passing in first argument) you can tell the collection not to execute them via:</p>
<pre><code class="php">$collection-&gt;returnClosure(true);   // Don't execute closure automatically
</code></pre>

<p>For more on Dependency Injection you can read our article regarding it.</p>
<h3 id="example-3-inheritance">Example #3 - Inheritance</h3>
<p>It's possible to create sub-collections within a collection and allow the sub collections to access the items present in the parent. To do so you just pass the parent collection in via the constructor.</p>
<pre><code class="php">// Create parent collection
$app = new \Cora\Collection();

// Define resource on parent
$app-&gt;resource1 = function($app) {
  return ['item1', 'item2'];
};

// Create child collection, passing parent in constructor
$app-&gt;subfolder = new \Cora\Collection($app);

// Define resource in child that depends on resource in parent
$app-&gt;subfolder-&gt;resource3 = function($app) {
  return new \Cora\Collection($app-&gt;resource1);
};

foreach ($app-&gt;subfolder-&gt;resource3 as $item) {
  echo $item; // Returns &quot;item1&quot; and &quot;item2&quot;
}
</code></pre>

<h3 id="speed-tests">Speed Tests</h3>
<p>The following tests were done using Cora model objects as the items. The sort method for the standard PHP sort test was done using "usort". Laravel and Cora use the same algorithm for sorting, so no comparison between them was necessary for sorting.</p>
<p><span class="text-green">Adding 30000 items to:</span>   </p>
<pre><code>Standard PHP Array  = 0.0063 seconds 
stdClass object     = 0.0172 seconds  
Laravel Collection  = 0.0988 seconds 
Cora Collection     = 0.1331 seconds        
</code></pre>

<p><span class="text-green">Accessing all 30000 items:</span>   </p>
<pre><code>Standard PHP Array  = 0.0047 seconds
Cora Collection     = 0.0823 seconds
Laravel Collection  = 0.1005 seconds
</code></pre>

<p><span class="text-green">Counting all 30000 items 30000 times:</span>   </p>
<pre><code>Standard PHP Array  = 0.0237 seconds
Cora Collection     = 0.0324 seconds
Laravel Collection  = 0.0577 seconds
</code></pre>

<p><span class="text-green">Sorting all 30000 items:</span>    </p>
<pre><code>Cora Collection     = 0.4270 seconds
Standard PHP Array  = 0.6603 seconds
</code></pre>

<h2 id="create-from-simple-array">Create From Simple Array</h2>
<p><span class="subTitle-h2">How to turn a basic array of items into a Collection object</span></p>
<pre><code class="php">$c = new \Cora\Collection([1,2,3,4,5]);
echo $c[4];             // Returns &quot;5&quot;. Standard array access format.
echo $c-&gt;off4;          // Returns &quot;5&quot;. Object access syntax.
echo $c-&gt;get(4);        // Returns &quot;5&quot;. Required by PSR-11.
echo $c-&gt;offsetGet(4);  // Returns &quot;5&quot;. Required by ArrayAccess interface.
echo $c[5];             // Returns null. No such offset.
</code></pre>

<div class="text-green">Observation #1:</div>

<p>Notice that trying to access an offset that doesn't exist returns "null" rather than throw an Exception.
This was a design choice with the Collection class that has tradeoffs and could potentially trip developers up. 
Make sure to check for a potentially null return as necessary when using this class.</p>
<div class="text-green">Observation #2:</div>

<p>You probably noticed that there's a bunch of different ways to access the same data via offsets. This is because 
different interfaces this class tries to be compatible with use different terminology. This first example was just 
for completeness; in the rest of this document we'll only show examples that feel appropriate.</p>
<h2 id="create-from-associative-array">Create From Associative Array</h2>
<p><span class="subTitle-h2">How to turn a basic array of items into a Collection object</span></p>
<pre><code class="php">$c = new \Cora\Collection([&quot;one&quot; =&gt; 1, &quot;two&quot; =&gt; 2, &quot;three&quot; =&gt; 3, &quot;four&quot; =&gt; 4, &quot;five&quot; =&gt; 5]);
echo $c[4];             // Returns &quot;5&quot;. Standard array access format.
echo $c[&quot;five&quot;];        // Returns &quot;5&quot;. Associative array access format.
echo $c-&gt;off4;          // Returns &quot;5&quot;. Object access format.
echo $c-&gt;five;          // Returns &quot;5&quot;. Direct Object access format.
</code></pre>

<div class="text-green">Observation #1:</div>

<p>Notice you can use either the numerical offset or the associative array key to get the value.</p>
<div class="text-green">Observation #2:</div>

<p>The two different Object style access options both work well, but a discussion into the difference 
(internally) will be covered in the section on performance optimizations.</p>
<h2 id="create-from-object-array">Create From Object Array</h2>
<p><span class="subTitle-h2">How to turn a basic array of objects into a Collection object</span></p>
<p>Below you'll find the most basic example of loading objects into a Collection. However, this does NOT showoff the cool features of Collections. See the Introduction or the "Why Object Syntax" sections for examples that much neater.</p>
<pre><code class="php">$rolesList = new \Cora\Collection([
    new \Models\Role('User'),
    new \Models\Role('Admin'),
    new \Models\Role('Developer')
];
echo $c[1]-&gt;name;        // Returns &quot;Admin&quot;
echo $c-&gt;off1-&gt;name;     // Returns &quot;Admin&quot;
</code></pre>

<h2 id="using-data-keys">Using Data Keys</h2>
<pre><code class="php">$c = new \Cora\Collection([
    [&quot;name&quot; =&gt; &quot;Jake&quot;, &quot;age&quot; =&gt; 33],
    [&quot;name&quot; =&gt; &quot;Bob&quot;, &quot;age&quot; =&gt; 42]
], 'name');
echo $c['Bob']['age'];  // Returns &quot;5&quot;. Standard array access format.
echo $c-&gt;Bob['age'];    // Returns &quot;5&quot;. Object access syntax.
</code></pre>

<p>When dealing with associative arrays or objects, you can optionally pass in a second argument to a Collection to make the items accessible by that identifier. In the example above, we used "name" as the key and so were able to grab Bob by 
his name directly.</p>
<p>If the key is not unique, the last item using that key will be the one returned.</p>
<h2 id="utility-methods">Utility Methods</h2>
<p>map</p>
<p>filter</p>
<p>where</p>
<h2 id="performance-optimizations">Performance Optimizations</h2>
<p><span class="subTitle-h2">The tricks used to make Cora Collections fast</span></p>
<p>Earlier we had an example (shown again below) in which there was two different ways to access 
some data in a Collection using an object style syntax.</p>
<pre><code class="php">$collection = new \Cora\Collection([&quot;one&quot; =&gt; 1, &quot;two&quot; =&gt; 2, &quot;three&quot; =&gt; 3, &quot;four&quot; =&gt; 4, &quot;five&quot; =&gt; 5]);
echo $collection-&gt;off4;          // Returns &quot;5&quot;. Object access format.
echo $collection-&gt;five;          // Returns &quot;5&quot;. Direct Object access format.
</code></pre>

<p>This provides a great opportunity to discuss the internal performance optimizations used in the 
Collection class, why both these options work, and the internal difference between them. In the examples 
below we'll use this collection as our starting point.</p>
<h3 id="optimization-1-fast-item-retrieval">Optimization #1: Fast Item Retrieval</h3>
<p>First off, let's do a var_dump on this collection. Don't let this overwhelm you, we'll walk through it below.</p>
<pre><code class="php">object(Cora\Collection)[121]
  protected 'parent' =&gt; boolean false
  protected 'signature' =&gt; 
    object(stdClass)[122]
  protected 'signaturesToSingletons' =&gt; 
    object(stdClass)[124]
  protected 'singleton' =&gt; 
    object(stdClass)[123]
      public 'one' =&gt; int 1
      public 'two' =&gt; int 2
      public 'three' =&gt; int 3
      public 'four' =&gt; int 4
      public 'five' =&gt; int 5
  protected 'content' =&gt; 
    array (size=5)
      'one' =&gt; int 1
      'two' =&gt; int 2
      'three' =&gt; int 3
      'four' =&gt; int 4
      'five' =&gt; int 5
  protected 'contentKeys' =&gt; 
    array (size=5)
      0 =&gt; string 'one' (length=3)
      1 =&gt; string 'two' (length=3)
      2 =&gt; string 'three' (length=5)
      3 =&gt; string 'four' (length=4)
      4 =&gt; string 'five' (length=4)
  protected 'size' =&gt; int 5
  protected 'contentModified' =&gt; boolean false
  protected 'returnClosure' =&gt; boolean false
  protected 'sortDirection' =&gt; boolean false
  protected 'sortKey' =&gt; boolean false
</code></pre>

<p>Alright, so this Collection's class stores resources in one of two data members... those being 
<span class="text-green">Singleton</span> or <span class="text-green">Signature</span>. 
Both those variables are instantiated to be PHP stdClass objects (generic objects you can 
store stuff within). The Singleton object stores any resources which are not 
Closures, so that includes numbers, strings, arrays, objects (excluding Closures), etc. In other words, most 
stuff you would throw in a Collection would end up there. The Signature object 
is exclusively for storing Closures (the name coming from the idea that it holds the "signatures" for 
how to create objects if you're using this class as a dependency injection container).</p>
<p>We can see from our example collection that we didn't define any Closures, so the Signature object is 
empty, but we did add some numbers to our collection, which are being stored in the Singleton object.</p>
<pre><code class="php">  protected 'signature' =&gt; 
    object(stdClass)[122]
  protected 'singleton' =&gt; 
    object(stdClass)[123]
      public 'one' =&gt; int 1
      public 'two' =&gt; int 2
      public 'three' =&gt; int 3
      public 'four' =&gt; int 4
      public 'five' =&gt; int 5
</code></pre>

<p>When we access item 5 via its offset name:</p>
<pre><code class="php">echo $collection-&gt;five;
</code></pre>

<p>the Collection class just ends up passing the 
request directly to the stdClass object. Access to object properties in PHP is done using a hash table and access 
times are in O(1) for efficiency. If you aren't familiar with Big-O notation, this just means the access time is 
constant no matter how many items you throw in your collection. It doesn't matter if you have a million items in 
the collection or five, the access time is the same.</p>
<p>However, the following work slightly differently:</p>
<pre><code class="php">echo $collection-&gt;off4;
echo $collection[4];
echo $collection-&gt;get(4);
</code></pre>

<p>When dealing with a numerical offset, it's our desire to have the same level of efficiency as using the offset name.
If we had a very large collection, what we don't want to happen is having to traverse through a million records to 
access offset 1,000,000. To accomplish this, the class will (only when necessary) calculate the offset keys. You 
might have noticed this in the original var_dump:</p>
<pre><code class="php">protected 'contentKeys' =&gt; 
    array (size=5)
      0 =&gt; string 'one' (length=3)
      1 =&gt; string 'two' (length=3)
      2 =&gt; string 'three' (length=5)
      3 =&gt; string 'four' (length=4)
      4 =&gt; string 'five' (length=4)
</code></pre>

<p>So what happens when we make a request for an item out of the collection using a numerical offset is it grabs the 
offset name using a hash lookup on this contentKeys array. The code looks like this:</p>
<pre><code class="php">return isset($this-&gt;contentKeys[$num]) ? $this-&gt;contentKeys[$num] : null;
</code></pre>

<p>So in the case of grabbing item five out of the collection using numerical offset 4, it grabs the key from contentKeys,
then uses that to do the direct access for the actual item. This means it has to do two hash lookups to grab the result,
but the efficiency stays in O(1). This is how access times are kept low and comparable to standard arrays.</p>
<p>Of course, this means we have to compute some data any time the content of our Collection changes. Which brings us to the next optimization...</p>
<h3 id="optimization-2-data-computed-only-when-needed">Optimization #2: Data Computed Only When Needed</h3>
<p>So without going into all the details, it's been established so far that there's computed data stored within a 
Collection instance. One of the pieces of computed data is the contentKeys array that enables efficient lookup 
of collection items no matter if you use a key or an offset number. What's important is that this table gets computed
only when necessary. Let's execute the following code:</p>
<pre><code class="php">// Add a new item to our collection
$collection-&gt;six = 6;
var_dump($collection);

// Retrieve the new item
echo $collection-&gt;six;
var_dump($collection);
</code></pre>

<p>If you look at the var_dump output of both of the above, you'll see that neither action changed the contentKeys array! This
is despite the fact that we added a new item to our collection:</p>
<pre><code class="php">protected 'singleton' =&gt; 
    object(stdClass)[119]
      public 'one' =&gt; int 1
      public 'two' =&gt; int 2
      public 'three' =&gt; int 3
      public 'four' =&gt; int 4
      public 'five' =&gt; int 5
      public 'six' =&gt; int 6
  protected 'contentKeys' =&gt; 
    array (size=5)
      0 =&gt; string 'one' (length=3)
      1 =&gt; string 'two' (length=3)
      2 =&gt; string 'three' (length=5)
      3 =&gt; string 'four' (length=4)
      4 =&gt; string 'five' (length=4)
</code></pre>

<p>The reason for this is that the keys are NOT recomputed automatically when you add a new item to the collection. Same goes for 
grabbing the item by its name. Neither of those actions required use of the key lookup array, and so the work to recompute it 
wasn't bothered with. When a collection is modified, it simply sets a flag internally, and when an action is taken that requires 
data be recomputed, THEN it will do it.</p>
<p>Let's try grabbing the new item 6 by numerical offset. That should cause the keys to get recomputed.</p>
<pre><code class="php">echo $collection[5];
</code></pre>

<p>Now looking at a fresh var_dump of our collection it looks like this:</p>
<pre><code class="php">protected 'singleton' =&gt; 
    object(stdClass)[119]
      public 'one' =&gt; int 1
      public 'two' =&gt; int 2
      public 'three' =&gt; int 3
      public 'four' =&gt; int 4
      public 'five' =&gt; int 5
      public 'six' =&gt; int 6
  protected 'contentKeys' =&gt; 
    array (size=6)
      0 =&gt; string 'one' (length=3)
      1 =&gt; string 'two' (length=3)
      2 =&gt; string 'three' (length=5)
      3 =&gt; string 'four' (length=4)
      4 =&gt; string 'five' (length=4)
      5 =&gt; string 'six' (length=3)
</code></pre>

<p>And sure enough, there's our new item in the keys array.</p>
<p>So to summarize, computed data should only get re-computed when necessary and will get avoided for efficiency's sake 
whenever possible.</p>
<h2 id="warning-about-mixing-closures-with-other-types">Warning About Mixing Closures With Other Types</h2>
<p>Closures won't be mixed with Singletons in the order they were added when mixed together to form
the "content" array. So $object-&gt;off5 might not give you the expected result. When mixing Closures 
with solid values, you need to use named offsets such as $object-&gt;repository.</p>
<h2 id="non-existent-resources">Non-Existent Resources</h2>
<p>This behavior has changed slightly in release 2.6. In the past, asking for a resource out of a collection
would return NULL if it wasn't present; this applied whether you used named offset or function syntax.</p>
<p><strong>How it used to work:</strong>    </p>
<pre><code class="php">$c = new \Cora\Collection();
$c-&gt;item1 = 'Foo';
$c-&gt;item2 = 'Bar';
echo $c-&gt;item3; // Returns NULL
echo $c-&gt;item3(); // Returns NULL
if ($c-&gt;count()) {
  echo 'There are items!';
}
</code></pre>

<p>Notice that "count()", since it's a function on the Collection class, was intelligently NOT treated like a 
resource offset. The problem with this setup was when you made a typo such as <code>$c-&gt;countt()</code> you would get 
no exceptions letting you know you goofed up. Instead it would think you were trying to access a resource 
and just return null without errors. This was a big programmer headache and bad design choice.</p>
<p>This has now been changed so that non-function calls to non-existent resources will still return null, but 
function calls will throw an exception.</p>
<p><strong>How it works now:</strong></p>
<pre><code class="php">$c = new \Cora\Collection();
$c-&gt;item1 = 'Foo';
$c-&gt;item2 = 'Bar';
echo $c-&gt;item2;   // Returns &quot;Bar&quot;
echo $c-&gt;item2(); // Returns &quot;Bar&quot;
echo $c-&gt;item3;   // Returns NULL
echo $c-&gt;item3(); // Throws an Exception!
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>